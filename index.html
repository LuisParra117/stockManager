<script>

    async function checkAuthentication() {

        try {
            const response = await fetch('/isAuthenticated');
            const data = await response.json();

            if (data.authenticated) {
                window.location.href = '/view/home.html';
            }

        } catch (error) {
            console.error('Error al verificar autenticación:', error);
            window.location.href = '/index.html';
        }
        
    }

    checkAuthentication();
</script>

<!DOCTYPE html>

<html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>StockManager</title>
        <link rel="icon" type="image/png" href="/assets/img/favicon/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="/assets/img/favicon/favicon.svg" />
        <link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="MedicaPro" />
        <link rel="manifest" href="/assets/img/favicon/site.webmanifest" />
        <link rel = "stylesheet" href = "assets/css/styleLogin.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
        <script src="assets/css/sweetalert.css"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
        <script src="assets/js/sweetalert.js" type = "text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" type = "text/javascript"></script>
        <script src="assets/js/jquery.js" type = "text/javascript"></script>
    </head>

    <body>

        <div class = "formulario" id = "formulario">
            
            <form method = "POST" id = "frmLogin" >

                <div  class = "container">
                    <img src  = "assets/img/logoStockManager.png" alt = "Logo stockManager" width = "200" height = "200">
                </div>   

                <div class = "username">
                    <input type = "text" id = "username" name = "username" required >
                    <label>Nombre de Usuario</label>
                </div>

                <div class = "password">
                    <input type = "password" id = "password" name = "password" required >
                    <label>Contraseña</label>
                </div>

                <button  id = "btnLogin" type = "submit" class = "btnLogin" name = "btnLogin">Iniciar Sesión</button>    
                <p></p>
            </form>

        </div>

    </body>

    <script>

        $(function(){

            $('#btnLogin').click(function (e){
                e.preventDefault();

                var objLogin = {
                    username:$('#username').val(),
                    password:$('#password').val()
                };
                
                $.post('/login', objLogin, function (resp){
                        
                    switch(resp){

                        case 'success':
                            window.location.href = '/view/home.html'; 
                            break;

                        case 'error':
                            errorMessage('Datos de usuario incorrectos');
                            break;

                        case 'Error en el servidor':
                            errorMessage('No hay conexion al servidor');
                            break;
                    }               

                });

            });

        });

        function errorMessage(message){

            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: message,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                backdrop: false,
                timer: 2000
            });

        }

    </script>

</html>